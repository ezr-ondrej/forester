CREATE TABLE images
(
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL CHECK (name <> '') UNIQUE
);

CREATE TABLE systems
(
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name TEXT NOT NULL DEFAULT random_name(),
  hwaddrs MACADDR[] NOT NULL CHECK (array_length(hwaddrs, 1) > 0),
  facts JSONB NOT NULL,
  acquired BOOLEAN NOT NULL DEFAULT FALSE,
  acquired_at TIMESTAMP NOT NULL DEFAULT '0001-01-01 00:00:00',
  image_id BIGINT REFERENCES images(id),
  comment TEXT DEFAULT ''
);

CREATE INDEX idx_systems_mac ON systems USING GIN(hwaddrs);
